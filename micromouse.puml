@startuml
' ========== CORE ==========
class Application {
    + run()
}

Application --> GUIManager: use

abstract class SimulationController {
    + start()
    + stop()
    + reset()
    + nextStep()
    + generateMaze()
    + setMouseMode(MouseMode)
    + setMouseBrain(MouseBrain&)
}

class Simulation {
    - Maze& maze
    - Micromouse& mouse
    + start()
    + stop()
    + reset()
    + nextStep()
    + generateMaze()
    + setMouseMode(MouseMode)
    + setMouseBrain(MouseBrain&)
}

Simulation -|> SimulationController
Simulation --> Maze
Simulation --> Micromouse

' ========== GUI ==========
class GUIManager {
    - sf::RenderWindow window
    - tgui::Gui gui
    - SimulationController& simulationController
    - std::vector<Drawable*> drawables
    + mainLoop()
    + switchMouseMode(MouseMode)
}

class Drawable {
    + draw(window: sf::RenderWindow)
}

abstract class Drawable

Drawable <|-- MazeRenderer
Drawable <|-- MouseRenderer

class MazeRenderer {
    - Maze& maze
    + draw(window: sf::RenderWindow)
}

class MouseRenderer {
    - Micromouse& mouse
    + draw(window: sf::RenderWindow)
}

GUIManager ---> SimulationController
GUIManager --> Drawable

' ========== MAZE ==========
class Maze {
    - int width
    - int height
    - std::vector<std::vector<Cell>> grid
    + generate()
    + getCell(x: int, y: int): Cell&
    + getWidth(): int
    + getHeight(): int
}

enum CellType {
    PATH
    START
    GOAL
}

struct Cell {
    + std::map<Direction, bool> walls
    + Position location
    + CellType type
}

Maze --> Randomizer: use

Maze "1" *-- Cell

enum Direction {
    NORTH
    EAST
    SOUTH
    WEST
}

' ========== MOUSE ==========
class Micromouse {
    - Position& position
    - MouseSensors& sensor
    - MouseBrain& brain
    - Direction direction
    + makeMove()
    + reset()
    + setMode(MouseMode)
    + setBrain(MouseBrain&)
}

class SensorsReading {
    - std::map<Direction, bool> readings
    + isWall(Direction): bool
}

class MouseSensors {
    - Maze& maze
    + getSensorsReading(Position): SensorsReading
}

class Position {
    - int x
    - int y
    + getX(): int
    + getY(): int
}

enum MouseMode {
    EXPLORATION
    FASTEST_PATH
}

Micromouse --> MouseSensors
Micromouse --> MouseBrain

MouseSensors --> Maze

' ========== MOUSE BRAIN ==========
class MouseBrain {
    - std::vector<std::vector<SensorsReading>> map
    - ExplorationStrategy& explorationStrategy
    - PathfindingStrategy& pathfindingStrategy
    - MouseMode mode
    - std::vector<Position> fastestPath
    + setMode(MouseMode)
    + getNextMove(SensorsReading): Direction
    + reset()
}

MouseBrain --> ExplorationStrategy
MouseBrain --> PathfindingStrategy

' ========== STRATEGIES ==========
abstract class ExplorationStrategy {
    + decideMove(Position, std::vector<std::vector<Cell>>): Direction
}

abstract class PathfindingStrategy {
    + decideMove(Position, std::vector<std::vector<Cell>>): Direction
    + findFastestPath(Position start, Position goal, std::vector<std::vector<Cell>> map): std::vector<Position>
}

ExplorationStrategy <|-- RandomExplorationStrategy
ExplorationStrategy <|-- BFSExplorationStrategy

PathfindingStrategy <|-- RandomFastestPathStrategy
PathfindingStrategy <|-- DijkstraPathfindingStrategy

class RandomExplorationStrategy {
    + decideMove(Position, std::vector<std::vector<Cell>>): Direction
}

class BFSExplorationStrategy {
    + decideMove(Position, std::vector<std::vector<Cell>>): Direction
}

class RandomFastestPathStrategy {
    + decideMove(Position, std::vector<std::vector<Cell>>): Direction
    + findFastestPath(Position start, Position goal, std::vector<std::vector<Cell>> map): std::vector<Position>
}

class DijkstraPathfindingStrategy {
    + decideMove(Position, std::vector<std::vector<Cell>>): Direction
    + findFastestPath(Position start, Position goal, std::vector<std::vector<Cell>> map): std::vector<Position>
}

' ========== UTILS ==========
class Randomizer {
    + GetRandom<T>(min: T, max: T): T
    + GetRandomDirection(): Direction
    - GetEngine(): std::mt19937&
}

RandomExplorationStrategy --> Randomizer: use
RandomFastestPathStrategy --> Randomizer: use

@enduml
